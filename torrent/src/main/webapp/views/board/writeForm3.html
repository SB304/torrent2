<!-- 기본틀 ! 복사해서 쓰시면됩니다 -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Warning Torrent &mdash; Mini2Team2</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
		<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
		<meta name="author" content="FREEHTML5.CO" />
		<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
		<link rel="shortcut icon" href="favicon.ico">
		<link rel="stylesheet" href="/torrent/resources/bootstrap/css/bootstrap.min.css">
		<!-- Google Webfonts -->
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
		<!-- Animate.css / Icomoon Icon Fonts / Magnific Popup / Salvattore / Theme Style / Modernizr JS-->
		<link rel="stylesheet" href="/torrent/resources/css/animate.css">
		<link rel="stylesheet" href="/torrent/resources/css/icomoon.css">
		<link rel="stylesheet" href="/torrent/resources/css/magnific-popup.css">
		<link rel="stylesheet" href="/torrent/resources/css/salvattore.css">
		<link rel="stylesheet" href="/torrent/resources/css/style.css">
		<script src="/torrent/resources/js/modernizr-2.6.2.min.js"></script>
		<!-- jQuery / jQuery Easing / Bootstrap  / Waypoints / Magnific Popup / Salvattore / Main JS -->
		<script src="/torrent/resources/js/jquery.min.js"></script>
		<script src="/torrent/resources/js/jquery.easing.1.3.js"></script>
		<script src="/torrent/resources/js/bootstrap.min.js"></script>
		<script src="/torrent/resources/js/jquery.waypoints.min.js"></script>
		<script src="/torrent/resources/js/jquery.magnific-popup.min.js"></script>
		<script src="/torrent/resources/js/salvattore.min.js"></script>
		<script src="/torrent/resources/js/main.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
   		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   		
	  <!-- Font Awesome -->
	  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	  <!-- Ionicons -->
<!-- 	  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css"> -->
   	  <!-- bootstrap wysihtml5 - text editor -->
 	 <link rel="stylesheet" href="/torrent/resources/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.css">
  	 <script src="/torrent/resources/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.js"></script>	
  	 <script src="/torrent/resources/js/jquery.form.js"></script> 
	</head>
	<body>
	<div class="topMenu"></div>
	<!-- END .header -->
	
	
	<div id="fh5co-main">
		<div class="container">
		<div class="row">
		<div class="col-md-10 col-md-offset-1">
			<h2>Movie Board</h2>
			<div class="fh5co-spacer fh5co-spacer-sm"></div>
					<form id="ajaxForm" action="write.json" method="post" enctype="multipart/form-data">
						<div class="row">
							<div class="col-md-12">
								<div class="form-group">
									<input type="text" class="form-control" name="title" placeholder="제목을 입력하세요">	
								</div>
							</div>
							<div class="col-md-12">
							<div id="myEditor">
				                <textarea class="textarea form-control" name="content" placeholder="게시글을 작성해 주세요" style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"></textarea>
				            </div>
								<div class="form-group">
										<br/><input type="file" name="attachFile" />
								</div>
										<div class="fh5co-spacer fh5co-spacer-sm"></div>
								<div style="display: inline;  bottom: 20px; right: 20px;">
										<button type="button" id="submitBtn"class="btn btn-primary">업로드</button>
										<button type="button" id="cancelBtn" class="btn">취소</button>  
								</div>
							</div>
						</div>
					</form>
					
				</div>
		
		</div>
		</div>
       </div>
	</div>
	<div class="footer"></div>

	<script>
		$("div.topMenu").load("/torrent/views/include/topMenu.html");
		$("div.footer").load("/torrent/views/include/footer.html");
	</script>
	<script>
	var flag = true;
	  $(function () {
		    $(".textarea").wysihtml5();
		  });

	  $("#myEditor").on(
				"click",
				"ul.wysihtml5-toolbar>li:eq(5)",
				function(){
					if(flag){
					var html = '<div class="form-group">'
						html +='<input type="hidden" id="showImg" value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">'
						html +='</div>'
						html +=	'<form id="imgForm" method="post" enctype="multipart/form-data" action="/readyImg.json">'
						html +=	'<input type="file" name="attachImg"/><br/>'
						html +='<input class="btn btn-primary" type="button" id="test" value="upload">'
					$("div.bootstrap-wysihtml5-insert-image-modal div.modal-body").html(html);
						html ='<a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">Cancel</a>'
						html +='<a id="hiddenBtn" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save" href="#">Insert image</a>'
						
					//$("div.bootstrap-wysihtml5-insert-image-modal div.modal-footer").html(html);
					console.log("테스트..");
					flag= false;
					}
					
					
					

				}
		);
	  
	  
	  $("#myEditor").on(
			  "click",
			  "#test",
			  function() {
					console.log("이미지올리자..");
			
					var fileEle = $("input[name='attachImg']")[0];
					//개수에상관없이 배열로 넘어옴?? 순수 jQuery객체로 사용하기위함
					console.dir(fileEle.files);
					console.dir(fileEle.files[0]);
					
					//폼의 데이터를 처리할 수 있는 자바 스크립트 객체가 추가됨!!
					var fd = new FormData();
					for(var i = 0; i<fileEle.files.length;i++){
						fd.append("attachImg"+i,fileEle.files[i]);
					}
					
			        $.ajax({
			            type : 'post',
			            url : 'readyImg.json',
			            data : fd,
			            processData : false,
			            contentType : false,
			            success : function(result) {
			            	$("#showImg").val(result);
			                alert("이미지를 업로드하였습니다.");
			                
			                
			            },
			            error : function(error) {
			                alert("이미지 업로드에 실패하였습니다.");
			                console.log(error);
			                console.log(error.status);
			            }
			        });
			    }
	  );
	  
	  $("#cancelBtn").click(function(){
		 alert("작성이 취소되었습니다.");
		 location.href="board3.html";
	  });
	  
 	  $("#submitBtn").click(function(){
			var fileEle = $("input[name='attachFile']")[0];
			//개수에상관없이 배열로 넘어옴?? 순수 jQuery객체로 사용하기위함
			console.dir(fileEle.files);
			console.dir(fileEle.files[0]);
			//폼의 데이터를 처리할 수 있는 자바 스크립트 객체가 추가됨!!
			var fd = new FormData();
			fd.append("title",$("input[name='title']").val());
			fd.append("content",$("textarea[name='content']").val());
			
			console.log($("input[name='title']").val())
			console.log($("textarea[name='content']").val())
			for(var i = 0; i<fileEle.files.length;i++){
				fd.append("attachFile"+i,fileEle.files[i]);
			}
			$.ajax({
				url : "write.json",
				data : fd,
				type : "POST",
				//파일 업로드 처리를 위한 옵션 2 추가
				processData: false,	//name = value 처리안하겠다
				contentType: false, //마찬가지...멀티파트로받아서..?
				success : function(result){
					alert("FormDate객체를 이용한 파일 업로드");
					location.href="board3.html";
				},
	            error : function(error) {
	                alert("게시글 작성에 실패하였습니다.");
	                console.log(error);
	                console.log(error.status);
	            }
			});
			
		});
	   

	  </script>
	</body>
	
</html>
