<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.torrent.mapper.BoardMapper3">

	<insert id="insertBoard" parameterType="Board">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select s_board_no.nextval from dual
		</selectKey>
	    insert into tbl_board(           
		    bno, id, genre, title, content   
		) values (                       
		    #{bno}, #{id}, #{genre}, #{title}, #{content} 
		)                               
	</insert>
	
	<update id="updateBoard" parameterType="Board">
		update tbl_board 
		   set title = #{title},
		       content = #{content} 
		 where bno = #{bno}    	    
	</update>
	
	<delete id="deleteBoard" parameterType="int">
	    delete
	      from tbl_board
	     where bno = #{bno} 
	</delete>
	
	<select id="selectBoard" resultMap="boardMap">
	    select *         
		  from tbl_board  
		 order by no desc 
	</select>
	
	<select id="selectBoardByNo" parameterType="int" 
	                             resultMap="boardMap">
	    select *         
		  from tbl_board  
		 where bno = #{bno}
	</select>
	
	
	<!-- ################################# -->
    <!-- 파일 부분 시작 -->	
    <!-- ################################# -->
    <insert id="insertBoardFile" parameterType="BoardFile">
		insert into tbl_file ( 
			bno,         
			oriName, 
			sysName, 
			path, 
			size
		) values (
			s_board_file_no.nextVal, 
			#{bno}, 
			#{oriName}, 
			#{sysName},
			#{path}, 
			#{size}		
		)
	</insert>

	
	<select id="selectBoardFileByNo" parameterType="int" resultType="File">
	    select bno,
	           oriName,
	           systemName,
	           path,
	           size
	      from tbl_file
	     where bno = #{bno}      
	</select>  
	
	<!-- 댓글 처리 DAO 시작 -->
	<!-- ################################# -->	
	<insert id="insertBoardComment" parameterType="boardComment">
		insert into tbl_reply(
			rno, bno, id, content
		) values (
			s_reply_no.nextVal, #{bno}, #{id}, #{content}
		)
	</insert>
	
	<select id="selectBoardCommentByNo" parameterType="int" resultType="boardComment">
	    select rno,
	           bno,
	           id,
	           content,
	           regDate
	      from tbl_reply
	     where bno = #{bno}      
	</select>
	
	<delete id="deleteBoardComment" parameterType="int">
	    delete 
	      from tbl_reply
	     where rno = #{rno}
	</delete>
	
	<update id="updateBoardComment" parameterType="BoardComment">
	    update tbl_reply
	       set content = #{content}
	     where rno = #{rno}
	</update>
	
	
	<!-- 추천수  -->
	<select id="countBoardRecommend" parameterType="int" resultType="int">
	select count(*)
	from tbl_like
	where bno=#{bno}
	</select>
	
	<select id="checkRecommend" parameterType="BoardRecommend" resultType ="BoardRecommend">
	select *
	from tbl_like
	where bno=#{bno} and id=#{id}
	</select>

	<insert id="insertBoardRecommend">
		insert into tbl_like(
			bno, id
		) values (
			#{bno},#{id}
		)
	</insert>
	<delete id="deleteBoardRecommend">
	    delete 
	      from tbl_like
	     where bno = #{bno} and id=#{id}
	</delete>
	           
		
</mapper>



































